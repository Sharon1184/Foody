<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurant Name - Kibandaski Deliveries</title>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <link rel="stylesheet" href="style.css" />
</head>
<body>

    <div class="top-toolbar">
        <a href="index.html" class="toolbar-icon"><ion-icon name="arrow-back-outline"></ion-icon></a>
        <a href="#" class="toolbar-icon"><ion-icon name="person-outline"></ion-icon></a>
    </div>

    <div class="delivery-location">
        <span>üìç Delivered to **Location Name**</span>
        <button class="change-location-btn">Change</button>
    </div>

    <section class="restaurant-header-section">
        <div class="restaurant-banner">
            <img id="restaurantBanner" src="https://via.placeholder.com/800x200?text=Restaurant+Banner" alt="Restaurant Banner">
            <div class="restaurant-info-overlay">
                <img id="restaurantLogo" class="restaurant-logo" src="https://via.placeholder.com/100?text=Logo" alt="Restaurant Logo">
                <h1 id="restaurantName">Loading Restaurant...</h1>
                <p id="restaurantCuisine" class="cuisine-tag">Loading Cuisine...</p>
                <div class="restaurant-ratings">
                    <ion-icon name="star"></ion-icon>
                    <span id="restaurantRating">N/A</span>
                    <span id="restaurantReviews">(0 reviews)</span>
                </div>
                <p class="restaurant-delivery-info">
                    <ion-icon name="bicycle-outline"></ion-icon> <span id="restaurantDeliveryTime">--</span> min
                    <span class="dot-separator"></span>
                    <ion-icon name="cash-outline"></ion-icon> KES <span id="restaurantDeliveryFee">--</span> delivery fee
                </p>
            </div>
        </div>
    </section>

    <section class="restaurant-menu-section">
        <div class="menu-tabs">
            <button class="menu-tab active" data-category="all">All Items</button>
            </div>

        <div class="menu-items-list" id="restaurantMenu">
            <p style="text-align: center; color: #888;">Loading menu items...</p>
        </div>
    </section>

    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h2>Your Cart</h2>
                <button class="close-cart-btn">&times;</button>
            </div>
            <div class="cart-items" id="cartItems">
                <p>Your cart is empty.</p>
            </div>
            <div class="cart-footer">
                <div class="cart-summary">
                    <span>Total:</span>
                    <span id="cartTotal">KES 0.00</span>
                </div>
                <button class="checkout-btn">Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <ion-icon name="home-outline"></ion-icon>
            <span>Home</span>
        </a>
        <a href="add-food.html" class="nav-item">
            <ion-icon name="add-circle-outline"></ion-icon>
            <span>Add Food</span>
        </a>
        <a href="#" class="nav-item">
            <ion-icon name="receipt-outline"></ion-icon>
            <span>Orders</span>
        </a>
        <a href="#" class="nav-item cart-icon-btn" id="openCartBtn">
            <ion-icon name="cart-outline"></ion-icon>
            <span>Cart</span>
            <span class="cart-badge" id="cartBadge">0</span>
        </a>
    </nav>

    <script type="module" src="main.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { renderFoodItems, updateCartDisplay, addToCart, updateCartItemQuantity } from './main.js'; // Import necessary functions from main.js

        const firebaseConfig = {
            apiKey: "AIzaSyB0AgMRtZZ9OGVGbmvdrpoUcdERXKZNo6s",
            authDomain: "food-ae7ff.firebaseapp.com",
            projectId: "food-ae7ff",
            storageBucket: "food-ae7ff.appspot.com",
            messagingSenderId: "891566620460",
            appId: "1:891566620460:web:04d7f1e1a9ae6a60cb3ad4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Restaurant Page Specific Logic ---
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const restaurantNameFromUrl = urlParams.get('name'); // Get restaurant name from URL

            if (!restaurantNameFromUrl) {
                document.getElementById('restaurantName').textContent = "Restaurant Not Found";
                document.getElementById('restaurantMenu').innerHTML = '<p style="text-align: center; color: red;">No restaurant specified.</p>';
                return;
            }

            // In a real application, you'd ideally have a 'restaurants' collection with unique IDs.
            // For now, we'll fetch all foods and filter by restaurant name.
            // A more scalable approach would be:
            // 1. Have a `restaurants` collection, where each document has an `id`, `name`, `logoUrl`, `bannerUrl`, etc.
            // 2. Pass the `restaurant.id` in the URL (e.g., `restaurant.html?id=restaurantId123`).
            // 3. Query the `foods` collection `where('restaurantId', '==', restaurantId)`.

            const foodsCollectionRef = collection(db, 'foods');
            const q = query(foodsCollectionRef, where('restaurant', '==', restaurantNameFromUrl));

            try {
                const querySnapshot = await getDocs(q);
                const foods = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                if (foods.length > 0) {
                    const firstFoodItem = foods[0]; // Use first item to infer restaurant details
                    document.getElementById('restaurantName').textContent = firstFoodItem.restaurant;
                    document.title = `${firstFoodItem.restaurant} - Kibandaski Deliveries`; // Update page title

                    // Dummy restaurant details for now
                    document.getElementById('restaurantCuisine').textContent = "Local Delights"; // You might add a cuisine field to food or restaurant docs
                    document.getElementById('restaurantRating').textContent = (Math.random() * 1 + 3.5).toFixed(1); // Random rating for demo
                    document.getElementById('restaurantReviews').textContent = `(${Math.floor(Math.random() * 200) + 50} reviews)`;
                    document.getElementById('restaurantDeliveryTime').textContent = Math.floor(Math.random() * 15) + 20;
                    document.getElementById('restaurantDeliveryFee').textContent = (Math.random() * 50 + 50).toFixed(2); // Random delivery fee

                    // Placeholder images - ideally, these would come from a 'restaurants' collection
                    const restaurantBanner = document.getElementById('restaurantBanner');
                    const restaurantLogo = document.getElementById('restaurantLogo');
                    restaurantBanner.src = `https://via.placeholder.com/800x200?text=${encodeURIComponent(firstFoodItem.restaurant)}+Banner`;
                    restaurantLogo.src = `https://via.placeholder.com/100?text=${encodeURIComponent(firstFoodItem.restaurant).charAt(0)}`;


                    // Render all food items for this restaurant
                    renderFoodItems('restaurantMenu', foods);

                    // Dynamically create menu categories/tabs
                    const menuTabsContainer = document.querySelector('.menu-tabs');
                    const categories = [...new Set(foods.map(food => food.category || 'Uncategorized'))]; // Assuming a 'category' field
                    categories.forEach(category => {
                        const button = document.createElement('button');
                        button.classList.add('menu-tab');
                        button.dataset.category = category.toLowerCase().replace(/\s/g, '-');
                        button.textContent = category;
                        menuTabsContainer.appendChild(button);
                    });

                    // Add click listener for menu tabs
                    menuTabsContainer.addEventListener('click', (e) => {
                        if (e.target.classList.contains('menu-tab')) {
                            document.querySelectorAll('.menu-tab').forEach(tab => tab.classList.remove('active'));
                            e.target.classList.add('active');
                            const selectedCategory = e.target.dataset.category;

                            const filteredFoods = selectedCategory === 'all'
                                ? foods
                                : foods.filter(food => (food.category || 'uncategorized').toLowerCase().replace(/\s/g, '-') === selectedCategory);
                            renderFoodItems('restaurantMenu', filteredFoods);
                        }
                    });

                } else {
                    document.getElementById('restaurantName').textContent = `${restaurantNameFromUrl} (No items found)`;
                    document.getElementById('restaurantMenu').innerHTML = '<p style="text-align: center; color: #888;">No menu items available for this restaurant.</p>';
                }
            } catch (error) {
                console.error("Error fetching restaurant data:", error);
                document.getElementById('restaurantName').textContent = "Error Loading Restaurant";
                document.getElementById('restaurantMenu').innerHTML = '<p style="text-align: center; color: red;">Failed to load restaurant details and menu.</p>';
            }

            // Initialize cart display for this page too
            updateCartDisplay();
        });

        // Event listener for add-to-cart buttons on this page
        document.body.addEventListener('click', (event) => {
            if (event.target.closest('.add-btn')) {
                const button = event.target.closest('.add-btn');
                const foodId = button.dataset.foodId;
                addToCart(foodId);
            }
            if (event.target.dataset.action === 'increment' || event.target.dataset.action === 'decrement') {
                const foodId = event.target.dataset.id;
                const action = event.target.dataset.action;
                updateCartItemQuantity(foodId, action);
            }
        });

        // Cart modal show/hide (re-used from main.js, ensure only one listener if shared)
        const cartModal = document.getElementById('cartModal');
        const openCartBtn = document.getElementById('openCartBtn');
        const closeCartBtn = document.querySelector('.close-cart-btn');

        if (openCartBtn && cartModal) { // Check if elements exist on this page
             openCartBtn.addEventListener('click', () => {
                cartModal.classList.add('show');
            });
            closeCartBtn.addEventListener('click', () => {
                cartModal.classList.remove('show');
            });
            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    cartModal.classList.remove('show');
                }
            });
        }
    </script>
</body>
                                                    </html>
